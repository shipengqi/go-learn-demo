<!DOCTYPE html>
<html lang="en">
  <head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">

    <title>Golang learning | strconv </title>
    <meta name="description" content>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    

    <!-- fonts -->
    <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Ubuntu:300,400,500,600,700" rel="stylesheet">

    <!-- stylesheets -->
    <link rel="stylesheet" href="/golang-learn/style/doc.css">

    <!-- favicon -->
    <link rel="icon" href="/golang-learn/images/favicon.ico">

    

  </head>
  <body>

   <script>window.__INITIAL_STATE__ = {"page":{"title":"strconv","path":"standards/text/strconv.html"},"data":{"navigation":{"logo":{"text":"Golang Learn","type":"link","path":"index.html"},"main":[{"text":"Golang 基础","type":"label"},{"text":"Go 环境配置","type":"link","path":"basic/env_config.html"},{"text":"包","type":"link","path":"basic/package.html"},{"text":"基础数据类型","type":"link","path":"basic/basic_data.html"},{"text":"变量","type":"link","path":"basic/var.html"},{"text":"常量","type":"link","path":"basic/constant.html"},{"text":"控制语句","type":"link","path":"basic/flow.html"},{"text":"运算符","type":"link","path":"basic/operator.html"},{"text":"作用域","type":"link","path":"basic/scope.html"},{"text":"指针","type":"link","path":"basic/pointer.html"},{"text":"数组","type":"link","path":"basic/array.html"},{"text":"切片","type":"link","path":"basic/slice.html"},{"text":"字典","type":"link","path":"basic/map.html"},{"text":"函数","type":"link","path":"basic/function.html"},{"text":"结构体","type":"link","path":"basic/struct.html"},{"text":"接口","type":"link","path":"basic/interface.html"},{"text":"面向对象","type":"link","path":"basic/oop.html"},{"text":"错误","type":"link","path":"basic/error.html"},{"text":"序列化","type":"link","path":"basic/json.html"},{"text":"反射","type":"link","path":"basic/reflect.html"},{"text":"测试","type":"link","path":"basic/test.html"},{"text":"并发编程","type":"label"},{"text":"goroutine","type":"link","path":"concurrent/goroutine.html"},{"text":"channel","type":"link","path":"concurrent/channel.html"},{"text":"同步和锁","type":"link","path":"concurrent/sync_lock.html"},{"text":"内存分配","type":"label"},{"text":"内存分配","type":"link","path":"advance/mm.html"},{"text":"垃圾回收","type":"label"},{"text":"垃圾回收","type":"link","path":"advance/gc.html"},{"text":"标准库","type":"label"},{"text":"fmt","type":"link","path":"standards/io/fmt.html"},{"text":"io","type":"link","path":"standards/io/io.html"},{"text":"ioutil","type":"link","path":"standards/io/ioutil.html"},{"text":"bufio","type":"link","path":"standards/io/bufio.html"},{"text":"os","type":"link","path":"standards/os/os.html"},{"text":"filepath","type":"link","path":"standards/os/filepath.html"},{"text":"strings","type":"link","path":"standards/text/strings.html"},{"text":"strconv","type":"link","path":"standards/text/strconv.html"},{"text":"unicode","type":"link","path":"standards/text/unicode.html"},{"text":"log","type":"link","path":"standards/log.html"},{"text":"time","type":"link","path":"standards/time.html"},{"text":"http","type":"link","path":"standards/net/http.html"},{"text":"math","type":"link","path":"standards/data/math.html"},{"text":"sort","type":"link","path":"standards/data/sort.html"},{"text":"big","type":"link","path":"standards/data/big.html"},{"text":"container","type":"link","path":"standards/data/container.html"},{"text":"sql","type":"link","path":"standards/database/sql.html"},{"text":"THEME","type":"label"},{"text":"使用文档主题","type":"link","path":"theme/theme-usage.html"},{"text":"SUPPORT AND FEEDBACK","type":"label"},{"text":"Raise an Issue on Github","type":"link","path":"https://github.com/shipengqi/golang-learn/issues/new"}]}},"config":{"timezone":"UTC","root":"/golang-learn/","time_format":"HH:mm:ss","theme":"../node_modules/hexo-theme-doc","theme_config":{"swagger_ui":{"version":2,"permalinks":true,"api_explorer":true,"download":"Download specification","show_extensions":false,"deep_linking":true,"display_operation_id":false,"doc_expansion":"none"},"search":{"skip":false,"background":false,"route":"/lunr.json"},"favicon":"images/favicon.ico"}}}</script>

    <div id="react-navigation-root"><div class="doc-navigation" data-reactroot><nav class="doc-navbar"><a href="/golang-learn/index.html" class="doc-navbar__logo"><img src="/golang-learn/images/logo.png" class="doc-navbar__logo__img"><span class="doc-navbar__logo__text">Golang Learn</span></a><i class="dc-icon dc-icon--close dc-icon--interactive doc-sidebar-close doc-navbar__sidebar-close doc-navbar__sidebar-close--desktop"></i><i class="dc-icon dc-icon--menu dc-icon--interactive doc-sidebar-toggle doc-navbar__sidebar-toggle"></i></nav><nav class="doc-sidebar"><div class="doc-sidebar__vertical-menu"><i class="dc-icon dc-icon--menu dc-icon--interactive doc-sidebar-toggle doc-sidebar-toggle--primary doc-sidebar__vertical-menu__item"></i><i class="dc-icon dc-icon--search dc-icon--interactive doc-sidebar__vertical-menu__item doc-sidebar__vertical-menu__item--primary"></i></div><div class="doc-sidebar-content"><div class="doc-sidebar__search-form"></div><ul class="doc-sidebar-list"></ul></div></nav></div></div>
    <div class="doc-content">
  <div class="dc-page">
    <div class="dc-card">
      <div id="react-search-results-root"></div>
      <div id="page-content" class="doc-formatting">
        <h1 id="strconv"><a href="#strconv" class="headerlink" title="strconv"></a>strconv</h1><p><code>strconv</code> 包包含了一系列字符串与相关的类型转换的函数。</p>
<h2 id="转换错误处理"><a href="#转换错误处理" class="headerlink" title="转换错误处理"></a>转换错误处理</h2><p><code>strconv</code> 中的错误处理。</p>
<p>由于将字符串转为其他数据类型可能会出错，<em>strconv</em> 包定义了两个 <em>error</em> 类型的变量：<em>ErrRange</em> 和 <em>ErrSyntax</em>。其中，<em>ErrRange</em> 表示<br>值超过了类型能表示的最大范围，比如将 “128” 转为 <code>int8</code> 就会返回这个错误；<em>ErrSyntax</em> 表示语法错误，比如将 <code>&quot;&quot;</code> 转为 <code>int</code> 类型会返<br>回这个错误。</p>
<p>然而，在返回错误的时候，通过构造一个 <em>NumError</em> 类型的 <em>error</em> 对象返回。<em>NumError</em> 结构的定义如下：<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A NumError records a failed conversion.</span></span><br><span class="line"><span class="keyword">type</span> NumError <span class="keyword">struct</span> &#123;</span><br><span class="line">    Func <span class="keyword">string</span> <span class="comment">// the failing function (ParseBool, ParseInt, ParseUint, ParseFloat)</span></span><br><span class="line">    Num  <span class="keyword">string</span> <span class="comment">// the input</span></span><br><span class="line">    Err  error  <span class="comment">// the reason the conversion failed (ErrRange, ErrSyntax)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>该结构记录了转换过程中发生的错误信息。该结构不仅包含了一个 <em>error</em> 类型的成员，记录具体的错误信息，包的实现中，定义了两个便捷函数，<br>用于构造 <em>NumError</em> 对象：<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">syntaxError</span><span class="params">(fn, str <span class="keyword">string</span>)</span> *<span class="title">NumError</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;NumError&#123;fn, str, ErrSyntax&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">rangeError</span><span class="params">(fn, str <span class="keyword">string</span>)</span> *<span class="title">NumError</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;NumError&#123;fn, str, ErrRange&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="字符串转为整型"><a href="#字符串转为整型" class="headerlink" title="字符串转为整型"></a>字符串转为整型</h2><p>包括三个函数：<code>ParseInt</code>、<code>ParseUint</code> 和 <code>Atoi</code>，函数原型如下：<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 转为有符号整型</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ParseInt</span><span class="params">(s <span class="keyword">string</span>, base <span class="keyword">int</span>, bitSize <span class="keyword">int</span>)</span> <span class="params">(i <span class="keyword">int64</span>, err error)</span></span></span><br><span class="line"><span class="function">// 转为无符号整型</span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">ParseUint</span><span class="params">(s <span class="keyword">string</span>, base <span class="keyword">int</span>, bitSize <span class="keyword">int</span>)</span> <span class="params">(n <span class="keyword">uint64</span>, err error)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">Atoi</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="params">(i <span class="keyword">int</span>, err error)</span></span></span><br></pre></td></tr></table></figure></p>
<p><strong><code>Atoi</code> 内部通过调用 <code>ParseInt(s, 10, 0)</code> 来实现的</strong>。</p>
<h3 id="ParseInt"><a href="#ParseInt" class="headerlink" title="ParseInt"></a>ParseInt</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ParseInt</span><span class="params">(s <span class="keyword">string</span>, base <span class="keyword">int</span>, bitSize <span class="keyword">int</span>)</span> <span class="params">(i <span class="keyword">int64</span>, err error)</span></span></span><br></pre></td></tr></table></figure>
<p>参数：</p>
<ul>
<li><code>base</code> 进制，取值为 <code>2~36</code>，如果 <code>base</code> 的值为 0，则会根据字符串的前缀来确定 <code>base</code> 的值：<br>“0x” 表示 16 进制； “0” 表示 8 进制；否则就是 10 进制。</li>
<li><code>bitSize</code> 表示的是整数取值范围，或者说整数的具体类型。取值 0、8、16、32 和 64 分别代表 <code>int</code>、<code>int8</code>、<code>int16</code>、<code>int32</code><br>和 <code>int64</code>。</li>
</ul>
<p>Go 中，<code>int/uint</code> 类型，不同系统能表示的范围是不一样的，目前的实现是，32 位系统占 4 个字节；64 位系统占 8 个字节。<br>当 <code>bitSize==0</code> 时，应该表示 32 位还是 64 位呢？<code>strconv.IntSize</code> 变量用于获取程序运行的操作系统平台下 int 类型所占的位数。</p>
<p>下面的代码 n 和 err 的值分别是什么？<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n, err := strconv.ParseInt(<span class="string">"128"</span>, <span class="number">10</span>, <span class="number">8</span>)</span><br></pre></td></tr></table></figure></p>
<p>在 <code>ParseInt/ParseUint</code> 的实现中，如果字符串表示的整数超过了 <code>bitSize</code> 参数能够表示的范围，则会返回 <code>ErrRange</code>，同时会<br>返回 <code>bitSize</code> 能够表示的最大或最小值。</p>
<p><code>int8</code> 占 8 位，最高位代表符号位 （1-负号；0-正号）。所以这里 n 是 127。</p>
<p>另外，<code>ParseInt</code> 返回的是 <code>int64</code>，这是为了能够容纳所有的整型，在实际使用中，可以根据传递的 <code>bitSize</code>，然后将结果转为实<br>际需要的类型。</p>
<h2 id="整型转为字符串"><a href="#整型转为字符串" class="headerlink" title="整型转为字符串"></a>整型转为字符串</h2><p>遇到需要将字符串和整型连接起来，在 Go 语言中，你需要将整型转为字符串类型，然后才能进行连接。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 无符号整型转字符串</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">FormatUint</span><span class="params">(i <span class="keyword">uint64</span>, base <span class="keyword">int</span>)</span> <span class="title">string</span>	</span></span><br><span class="line"><span class="function">// 有符号整型转字符串</span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">FormatInt</span><span class="params">(i <span class="keyword">int64</span>, base <span class="keyword">int</span>)</span> <span class="title">string</span>	</span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">Itoa</span><span class="params">(i <span class="keyword">int</span>)</span> <span class="title">string</span></span></span><br></pre></td></tr></table></figure></p>
<p><strong><code>Itoa</code> 内部直接调用 <em>FormatInt(i, 10)</em> 实现的</strong>。</p>
<p>除了使用上述方法将整数转为字符串外，经常见到有人使用 <em>fmt</em> 包来做这件事。如：<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fmt.Sprintf(<span class="string">"%d"</span>, <span class="number">127</span>)</span><br></pre></td></tr></table></figure></p>
<p>那么，这两种方式我们该怎么选择呢？我们主要来考察一下性能。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">startTime := time.Now()</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++ &#123;</span><br><span class="line">    fmt.Sprintf(<span class="string">"%d"</span>, i)</span><br><span class="line">&#125;   </span><br><span class="line">fmt.Println(time.Now().Sub(startTime))</span><br><span class="line"></span><br><span class="line">startTime := time.Now()</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++ &#123;</span><br><span class="line">    strconv.Itoa(i)</span><br><span class="line">&#125;   </span><br><span class="line">fmt.Println(time.Now().Sub(startTime))</span><br></pre></td></tr></table></figure></p>
<p><code>Sprintf</code> 的时间是 3.549761ms，而 <code>Itoa</code> 的时间是 848.208us，相差 4 倍多。</p>
<p><code>Sprintf</code> 性能差些可以预见，因为它接收的是 <code>interface</code>，需要进行反射等操作。建议使用 <code>strconv</code> 包中的方法进行转换。</p>
<h2 id="字符串和布尔值之间的转换"><a href="#字符串和布尔值之间的转换" class="headerlink" title="字符串和布尔值之间的转换"></a>字符串和布尔值之间的转换</h2><p>Go 中字符串和布尔值之间的转换比较简单，主要有三个函数：<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接受 1, t, T, TRUE, true, True, 0, f, F, FALSE, false, False 等字符串；</span></span><br><span class="line"><span class="comment">// 其他形式的字符串会返回错误</span></span><br><span class="line"><span class="comment">// 返回转换后的布尔值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ParseBool</span><span class="params">(str <span class="keyword">string</span>)</span> <span class="params">(value <span class="keyword">bool</span>, err error)</span></span></span><br><span class="line"><span class="function">// 直接返回 "<span class="title">true</span>" 或 "<span class="title">false</span>"</span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">FormatBool</span><span class="params">(b <span class="keyword">bool</span>)</span> <span class="title">string</span></span></span><br></pre></td></tr></table></figure></p>
<h2 id="字符串和浮点数之间的转换"><a href="#字符串和浮点数之间的转换" class="headerlink" title="字符串和浮点数之间的转换"></a>字符串和浮点数之间的转换</h2><p>类似的，包含三个函数：<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 无论 bitSize 取值如何，函数返回值类型都是 float64。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ParseFloat</span><span class="params">(s <span class="keyword">string</span>, bitSize <span class="keyword">int</span>)</span> <span class="params">(f <span class="keyword">float64</span>, err error)</span></span></span><br><span class="line"><span class="function">// 第一个参数是输入浮点数</span></span><br><span class="line"><span class="function">// 第二个是浮点数的显示格式（可以是 <span class="title">b</span>, <span class="title">e</span>, <span class="title">E</span>, <span class="title">f</span>, <span class="title">g</span>, <span class="title">G</span>）</span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">FormatFloat</span><span class="params">(f <span class="keyword">float64</span>, fmt <span class="keyword">byte</span>, prec, bitSize <span class="keyword">int</span>)</span> <span class="title">string</span></span></span><br></pre></td></tr></table></figure></p>
<p><code>prec</code> 表示有效数字（对 <code>fmt=&#39;b&#39;</code> 无效），对于 ‘e’, ‘E’ 和 ‘f’，有效数字用于小数点之后的位数；<br>对于 ‘g’ 和 ‘G’，则是所有的有效数字。例如：<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">strconv.FormatFloat(<span class="number">1223.13252</span>, <span class="string">'e'</span>, <span class="number">3</span>, <span class="number">32</span>)	<span class="comment">// 结果：1.223e+03</span></span><br><span class="line">strconv.FormatFloat(<span class="number">1223.13252</span>, <span class="string">'g'</span>, <span class="number">3</span>, <span class="number">32</span>)	<span class="comment">// 结果：1.22e+03</span></span><br></pre></td></tr></table></figure></p>
<p>由于浮点数有精度的问题，精度不一样，<code>ParseFloat</code> 和 <code>FormatFloat</code> 可能达不到互逆的效果。如：<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s := strconv.FormatFloat(<span class="number">1234.5678</span>, <span class="string">'g'</span>, <span class="number">6</span>, <span class="number">64</span>)</span><br><span class="line">strconv.ParseFloat(s, <span class="number">64</span>)</span><br></pre></td></tr></table></figure></p>
<p>另外，<code>fmt=&#39;b&#39;</code> 时，得到的字符串是无法通过 <code>ParseFloat</code> 还原的。</p>
<p>同样的，基于性能的考虑，应该使用 <code>FormatFloat</code> 而不是 <code>fmt.Sprintf</code>。</p>

        <div id="react-support-footer-root"></div>
      </div>
    </div>
  </div>
</div>

    


    

    <!-- js vendors -->
    <script src="//code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/lunr.js/2.1.0/lunr.min.js"></script>

    <!-- js source  -->
    <script src="/golang-learn/script/doc.js"></script>

    

  </body>
</html>
